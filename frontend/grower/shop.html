<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../style.css" />
    <script type="module" crossorigin src="/assets/index-DgTvZtMc.js"></script>
  </head>
  <body>
    <div class="body">
      <header>
        <nav class="navbar">
          <div class="nn">
            <a href="shop.html" class="active">Home</a>
            <a href="store.html">Store</a>
            <a href="#about">About Us</a>
            <a href="#contact">Contact</a>
            <div id="header-buttons" style="display: block">
              <a style="padding-right: 1px; cursor: pointer" id="btn-signup"
                >Sign up</a
              >
              <button class="tertiary" id="btn-login">Login</button>
            </div>
            <a href="#profile" id="profile" style="display: none">dfghj</a>
          </div>
        </nav>
      </header>
      <div class="shop">
        <!-- <div class="container">
      <div class="row">
        <div class="col-9 filters">Column</div>
        <div class="col content">Column</div>
      </div>
    </div> -->
        <div class="container">
          <div class="box-1 box">
            <div class="box-content">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Esse
              voluptas ipsam voluptatem consequuntur voluptates quos obcaecati
              doloremque enim quo perferendis iste repellendus molestiae
              repellat incidunt culpa, eveniet sunt commodi exercitationem!
            </div>
            <br />
            <button
              class="btn btn-primary primary"
              onclick="window.location.href='./upload.html'"
            >
              Upload
            </button>
          </div>
          <div class="box-2 box">
            <div class="box-content">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Esse
              voluptas ipsam voluptatem consequuntur voluptates quos obcaecati
              doloremque enim quo perferendis iste repellendus molestiae
              repellat incidunt culpa, eveniet sunt commodi exercitationem!
            </div>
            <br />
            <button class="btn btn-primary primary">Orders</button>
          </div>
          <div class="box-3 box">
            <div class="box-content">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Esse
              voluptas ipsam voluptatem consequuntur voluptates quos obcaecati
              doloremque enim quo perferendis iste repellendus molestiae
              repellat incidunt culpa, eveniet sunt commodi exercitationem!
            </div>
            <br />
            <button
              class="btn btn-primary primary"
              onclick="window.location.href='./store.html'"
            >
              My Store
            </button>
          </div>
          <div class="box-4 box">
            <div class="box-content">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Esse
              voluptas ipsam voluptatem consequuntur voluptates quos obcaecati
              doloremque enim quo perferendis iste repellendus molestiae
              repellat incidunt culpa, eveniet sunt commodi exercitationem!
            </div>
            <br />
            <button class="btn btn-primary primary">Buy Now</button>
          </div>
        </div>
      </div>
      <div class="modal login" id="login" style="display: none">
        <!-- <div class="login"> -->
        <div class="login-page">
          <div class="form-container">
            <button type="button" class="btn-close" id="login-close"></button>
            <div class="form-content">
              <h2 style="margin: 15px">Login</h2>
              <form>
                <div class="input-group">
                  <span class="input-group-text">Email:</span>
                  <input
                    type="email"
                    id="login-email"
                    name="email"
                    class="form-control"
                    required
                  />
                </div>
                <div class="input-group">
                  <span class="input-group-text">Password:</span>
                  <input
                    type="password"
                    id="login-password"
                    name="password"
                    class="form-control"
                    required
                  />
                </div>
                <div id="loginAlertPlaceholder"></div>
                <input
                  type="button"
                  value="Login"
                  class="btn btn-primary"
                  id="liveAlertBtn"
                />

                <p style="margin: 0px 20px 100px">
                  Don't have an account? <a href="./sign-up.html">Sign Up</a>
                </p>
              </form>
              <!-- </div> -->
            </div>
          </div>
        </div>
      </div>
      <div class="modal signup" id="signup" style="display: none">
        <!-- <div class="login"> -->
        <div class="signup-page">
          <div class="form-container">
            <button type="button" class="btn-close" id="signup-close"></button>
            <div class="form-content">
              <h2 style="margin: 15px">Sign Up</h2>

              <form>
                <div class="input-group">
                  <span class="input-group-text">Username</span>
                  <input
                    type="text"
                    class="form-control"
                    id="username"
                    name="username"
                    required
                  />
                </div>
                <div class="input-group">
                  <span class="input-group-text">Email</span>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    required
                  />
                </div>

                <div class="input-group">
                  <span class="input-group-text">Password</span>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    name="password"
                    required
                  />
                </div>
                <div class="input-group">
                  <span class="input-group-text">Confirm Password</span>
                  <input
                    type="password"
                    class="form-control"
                    id="confirm-password"
                    name="confirm-password"
                    required
                  />
                </div>
                <div style="margin-left: 15px; margin-bottom: 10px">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="type"
                      id="grower"
                    />
                    <label class="form-check-label" for="grower">
                      Grower
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="type"
                      id="consumer"
                    />
                    <label class="form-check-label" for="consumer">
                      Consumer
                    </label>
                  </div>
                </div>
                <div id="signupAlertPlaceholder"></div>
                <input
                  type="button"
                  value="Sign-up"
                  class="btn btn-primary"
                  id="submit"
                />

                <p>Already have an account? <a href="./login.html">Login</a></p>
              </form>
              <!-- </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"
      defer
    ></script>

    <script>
      const loginAlertPlaceholder = document.getElementById(
        "loginAlertPlaceholder"
      );
      const signupAlertPlaceholder = document.getElementById(
        "signupAlertPlaceholder"
      );
      const btn_login = document.getElementById("btn-login");
      const btn_signup = document.getElementById("btn-signup");
      const login = document.getElementById("login");
      const signup = document.getElementById("signup");
      const alertTrigger = document.getElementById("liveAlertBtn");
      const login_email = document.getElementById("login-email");
      const login_password = document.getElementById("login-password");
      const submit = document.getElementById("submit");
      const username = document.getElementById("username");
      const email = document.getElementById("email");
      const password = document.getElementById("password");
      const confirm_password = document.getElementById("confirm-password");
      const type = document.getElementsByName("type");
      const login_close = document.getElementById("login-close");
      const signup_close = document.getElementById("signup-close");
      const header_buttons = document.getElementById("header-buttons");
      const profile = document.getElementById("profile");

      const appendAlert = (message, type, ls) => {
        const wrapper = document.createElement("div");

        wrapper.innerHTML = [
          `<div class="alert alert-${type} alert-dismissible" role="alert">`,
          `   <div>${message}</div>`,
          '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
          "</div>",
        ].join("");
        if (ls == "login") loginAlertPlaceholder.append(wrapper);
        if (ls == "signup") signupAlertPlaceholder.append(wrapper);
      };

      alertTrigger.addEventListener("click", () => {
        console.log("Login process initiated");
        if (login_email.value === "" || login_password.value === "") {
          alert("Please fill in all fields");
        } else {
          const data = {
            email: login_email.value,
            password: login_password.value,
          };
          axios.post("http://localhost:3000/login", data).then((res) => {
            appendAlert(res.data.message, res.data.alert, "login");
            if (res.data.alert == "success") {
              console.log("Storing email in localStorage");
              localStorage.setItem("email", login_email.value);
              login.style.display = "none";
              signup.style.display = "none";
              header_buttons.style.display = "none";
              profile.style.display = "block";
              profile.innerText = login_email.value;
              console.log(profile.innerText);
            } else {
              console.log("Login failed, resetting fields");
              if (res.data.message == "Password incorrect") {
                login_password.value = "";
              } else {
                login_email.value = "";
                login_password.value = "";
                login.style.display = "none";
                signup.style.display = "block";
                // window.location.href = "./login.html";
              }
            }
          });
        }
      });

      submit.addEventListener("click", () => {
        let selectedType = "";
        for (const element of type) {
          if (element.checked) {
            selectedType = element.id;
            break;
          }
        }

        if (
          username.value === "" ||
          email.value === "" ||
          password.value === "" ||
          confirm_password.value === "" ||
          selectedType === ""
        ) {
          alert("Please fill in all fields");
        } else if (password.value !== confirm_password.value) {
          alert("Passwords don't match");
          confirm_password.value = "";
        } else {
          const data = {
            username: username.value,
            email: email.value,
            password: password.value,
            selectedType: selectedType,
          };
          axios
            .post("http://localhost:3000/signup", data)
            .then((res) => {
              appendAlert(res.data.message, res.data.alert, "signup");
              setTimeout(() => {
                if (res.data.alert == "success") {
                  login.style.display = "block";
                  signup.style.display = "none";
                } else if (res.data.alert == "danger") {
                  login.style.display = "block";
                  signup.style.display = "none";
                }
              }, 1000);
            })
            .catch((err) => {
              console.error("Error:", err);
              alert("An error occurred while logging in.");
            });
          console.log("Hello World");
        }
      });
      btn_login.addEventListener("click", () => {
        login.style.display = "block";
      });
      btn_signup.addEventListener("click", () => {
        signup.style.display = "block";
      });
      login_close.addEventListener("click", () => {
        login.style.display = "none";
      });
      signup_close.addEventListener("click", () => {
        signup.style.display = "none";
      });
    </script>
  </body>
</html>
